env:
  global:
  - secure: uKtKg5Iut3AaPwDpPzHZbaWSwX43ejQo8LqUDlYeLME3/IVaTMtFhJbG2CdhmYyQ6JKq6opaRGT7ojq6YmiRoUl+cYCYTQO17I9WZ5Lgzm8B6RpmpXGDJKI0vrSp/o/hHw0ISrG2RzOk+spj+1LuR9wnw7YtOUCjGVIpDK4WZnSPxw8Ygn0mDXdUrBfRmhuD0J+CP2v87prmsyJt0kQHI2i9fzI7XXLm01hPOIIpXaAUwhNGnemZTMaY8oZxHz/OkSQUXZ1MynLcCmQHweAjkfUfzbvO2x/h8LMp5jF2VddIEVGcsxNqE9eU3gu0dQyRjOsi3c9qOJScouhNMdZDIv6zQBGEK1LTGHES28uLtUu7jtx2lg3Sn7wcjA4mPitEDiy9NTDF0FpwiDzXdRx4wcELmlWQwLGxTUn5r0hETboRrG9bkyJsVxljORE0HLhK2EEMguz36DUSEFljwJm7Uz4c304Jsm8odOzsTs5WOecsUTh3t+fqQjMB9dRNWXeK/Z0g3yVbq5jkM3F7ZE3Ep85W7Fe6Zl+nHfSkYgIkmjH0+d8hYrKBOH4mmJ/TpoyxGeY3IgG89QmdXQO7EZIYLHfGFwsyCMyX2BfVENwRfCY34hfA/HlWDdqyYBOsHAUNGxwbO9vADPqKmLQpP+0ciYVyjYgoaaEK1thYPLv9atE=
  - secure: gcUUDVdaPaPlbap8Jh7/kEC9SCDbKViemtS5C6lGwccoZCWZp0xi+B3hGDX1eUJ5Y+2+XAFpk/VGoAe9DtJUWYTcPhvMqbBQOfZAWxQyvaUcCRriTEbkXHvjxMI1X8lEBCxdqvhDG0ZaOwbLk0SO5VMdEdewUZ3mC8GJgu3ZoKFGoWT1WzPoMnVbpGPH+Ws0UbSQIFt/874/Qf6kOyPHpUW+AzE9Jq3X1PfYf3ZMVcvRKlpKbbIwx793etnP3DSQJXqBUbe30r/WIt8XNlngr2ev1rMC18jJ4pkhibpLXk08l7KK0EoFMrRgxLV9qo/8gMKEOa61HWkxPeUd85+7Wa8gRKTTThan2WZNO7zBKRw4paZw1In4G3ixh1wUL/ugH2YWcDRC19fW6jRVlrLu1xdrbe8SgAie5IQT8UjtFA7lltE8hsGTmPL4GppeiH8XMXsW7U18hmewc45NidZXuKdXJ4vnsnjF2SBuQ8go5cCcHNpPiqS0zCZ+SBUQiaybQ44m0oEkkLJiOPDCL384X6GBvfE/QKtHw9SUqx3spOfSUsLqLiIRF2qAPzVMCeU8O3VvYFrGVxWQ7dCmh26LDkTT3bFOVO6GfRUMnAG4gJgVqaRpAjNFU2EmWbt/WtDCrYEI7AdST2kBIS0nT13ssJUSdfNFcY5yIydwpVY1474=

services:
- docker

addons:
  sonarcloud:
    organization: departement-loire-atlantiqu-1
    token:
      secure: JG//GILCabtEYH7mIub/TFqzSgU75tMw6kWV8UYkWzKFQqdMwHZaBZ1d//0OGirLQ7PwKlrrcMPcDZE+4A3vRVt/MKXi+o8nevqzE68fRTobEHmrSMQGvt4r4eyVALMLN1uM148wGrcTG2v/xK8S39cAaaaopCyOU431z1RRiu92TCCNya+VpvR+mn/w43vVHMXBMXzypUVdn7agNafCLOg1TUQEiDcEXToaF1nTnLFCfWAQ4jEQRsu5zbgyrOhCmuloBYA1T2L3ZMdksWdiLEEhppxKk/0IyzRpZJyOx1Vi+SPVM4jOPU5m4+nYXc9QkHOAgJpxSgPPr9kVf/lATmZsvcApKP3CCzDiZXEq+DeLZiGmXL6oR+n1sMe2O3Pa+hGukMa2rXAOb9b4CMtDQuB3QtVHv/cBotWrLQW4/nB1+iAuuVSgRGTY39c7xwfMKpwUQI1Oyc+YP+VO0Ck8yBab/APudO61iZ5RIMcpNIjXEIW18/mrcA2k9oF8vkUpw2WkkJRzxvzq3l/dg/iQ01iphEL4BjEPToaNXeiIzXDxSlY/fsUDwQB3KJj9HxMNDPfPYnFUapjvol1WrQGK/hKMwRSciXW8klfU4QrKZDSQqNHmkap3LoLcURhnMTBatdSo9FeBoj+oG2qrdBcUSImJ6WAqfdZ8XZKwpiyLuWY=

before_script:
- echo "$DOCKER_PASS" | docker login --username $DOCKER_USER --password-stdin
- docker pull sguellec/jplatformbuild

script:
- docker run -v ${TRAVIS_BUILD_DIR}:/root/source --name buildimage -t sguellec/jplatformbuild
- docker cp buildimage:/root/dist .
- export CODE_VERSION=`git describe`
- sonar-scanner -Dsonar.projectVersion=$CODE_VERSION

deploy:
  provider: releases
  api_key:
    secure: g9VqkDEHQDbxtmn4Ji01jF89OGPn3plIaOHxKDpWU9IfnapWf3Dhr476isl95Wq16GX5xxzWwNM7PxX0D4x26alyAnjjKYiW2a2ckxWPQYUh6aH60NiYmYfwHk9FbYjBPKgf3zMeEg88Q58gYhIuSQKfWuqbvuSmW0K7DZn89aHzEP1iQyk2FO7OCMTIiNTm2BhsPEdOtqtjYdw5ZK+ruoBE/qHhJrJZiXB2wDg911cJ9fnEBPzuasR16zkqrkGKfC9ihytcXyRWO9mcf0l/Vvq/U0U2Qeaz7i2u/MaSEY4PG9RNKTR9oELXquZ16YkTgJkaFM0g+Ak05ONeskm6BT6zQ8Cu9+ex94QDsH6mkStYLCYBgyA2h85hRVt5TJ4VFCUIE8R6RScCAGOlygWNjEiNWifb4M7xZS55zWlXS87Wh5VRomZnUF1RLzB0X3Eo6ctBuE1NGzGA/7q50WiO0rZL7lKV/EXgqJTJHyI+FJnF+Sx9XRcRVI/Vs9tcw1Sy9sAeUALi2rlBDyRHHOcnfMVMZ7gIEtYzCXy0cUpMHLtM43xk6fqcpuSiA1vRO6L1rOemwScV8XhXIedcnmGEfowfW2oAp0GVX9o3X1Ub2wn0+bM8AjZXWWjU7kAk2bNuZvfG1/7N5SRdrXBmL93NCn5WW6h5BdrqAVAJjESuGDA=
  file_glob: true
  file: "${TRAVIS_BUILD_DIR}/dist/*.zip"
  skip_cleanup: true
  on:
    tags: true
